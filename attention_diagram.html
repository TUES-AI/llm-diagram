<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scaled Dot-Product Attention — light, square cells</title>
<style>
  :root{
    --bg:#fff;
    --ink:#111;
    --muted:#58606e;
    --stroke:#1f2937;
    --chip:#f3f4f6;
    --grid:#d9dce3;
    --hi:#b91c1c;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  svg{display:block;width:100%;height:auto}
  .box{fill:none;stroke:var(--stroke);stroke-width:1.6}
  .chip{fill:var(--chip);stroke:var(--stroke);stroke-width:1.6;rx:10;ry:10}
  .label{font-size:18px;fill:var(--ink)}
  .head{font-size:20px;font-weight:700;letter-spacing:.4px;fill:var(--ink)}
  .dim{font-size:14px;fill:var(--muted)}
  .axis{font-size:13px;fill:var(--muted)}
  .math{font-size:36px;font-style:italic;fill:var(--ink)}
  .gridcell{stroke:var(--grid);stroke-width:.7}
</style>
</head>
<body>
<svg viewBox="0 0 1720 920" aria-labelledby="t">
  <title id="t">Scaled dot-product attention</title>

  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M0,0 L10,5 L0,10 Z" fill="var(--stroke)"/>
    </marker>
  </defs>

  <!-- Tokens list -->
  <g transform="translate(58,160)">
    <text x="0" y="-20" class="axis">The</text>
    <text x="-28" y="8"  class="axis">American</text>
    <text x="-6"  y="36" class="axis">flag</text>
    <text x="8"   y="64" class="axis">is</text>
    <text x="-6"  y="92" class="axis">red</text>
    <text x="14"  y="120" class="axis">,</text>
    <text x="-22" y="148" class="axis">white</text>
    <text x="14"  y="176" class="axis">,</text>
    <text x="-2"  y="204" class="axis">and</text>
  </g>

  <!-- X embeddings (two skinny blocks just to suggest 9x768) -->
  <g transform="translate(120,120)">
    <rect x="0" y="0" width="120" height="90" class="box"/>
    <g id="X1"></g>
    <rect x="150" y="0" width="120" height="90" class="box"/>
    <g id="X2" transform="translate(150,0)"></g>
    <text x="120" y="112" class="dim" text-anchor="middle">9×768</text>
    <text x="120" y="140" class="label" font-style="italic" text-anchor="middle">X</text>
  </g>

  <!-- WQ, WK, WV -->
  <g transform="translate(320,128)">
    <rect width="94" height="56" class="chip"/>
    <text x="47" y="24" class="label" text-anchor="middle" font-style="italic">W<tspan baseline-shift="sub" font-size="75%">Q</tspan></text>
    <text x="47" y="42" class="dim" text-anchor="middle">768×64</text>
  </g>
  <g transform="translate(320,320)">
    <rect width="94" height="56" class="chip"/>
    <text x="47" y="24" class="label" text-anchor="middle" font-style="italic">W<tspan baseline-shift="sub" font-size="75%">K</tspan></text>
    <text x="47" y="42" class="dim" text-anchor="middle">768×64</text>
  </g>
  <g transform="translate(320,512)">
    <rect width="94" height="56" class="chip"/>
    <text x="47" y="24" class="label" text-anchor="middle" font-style="italic">W<tspan baseline-shift="sub" font-size="75%">V</tspan></text>
    <text x="47" y="42" class="dim" text-anchor="middle">768×64</text>
  </g>

  <!-- Arrows from X to W* -->
  <line x1="245" y1="165" x2="320" y2="165" stroke="var(--stroke)" stroke-width="1.8" marker-end="url(#arrow)"/>
  <line x1="245" y1="357" x2="320" y2="357" stroke="var(--stroke)" stroke-width="1.8" marker-end="url(#arrow)"/>
  <line x1="245" y1="549" x2="320" y2="549" stroke="var(--stroke)" stroke-width="1.8" marker-end="url(#arrow)"/>

  <!-- Q, K, V matrices -->
  <g id="Qwrap" transform="translate(450,110)">
    <text x="0" y="-16" class="head">QUERIES</text>
    <rect width="576" height="81" class="box"/>
    <g id="Q"></g>
    <text x="560" y="104" class="dim">9×64</text>
    <text x="288" y="132" class="label" text-anchor="middle" font-style="italic">Q = XW<tspan baseline-shift="sub" font-size="75%">Q</tspan></text>
  </g>

  <g id="Kwrap" transform="translate(450,302)">
    <text x="0" y="-16" class="head">KEYS</text>
    <rect width="576" height="81" class="box"/>
    <g id="K"></g>
    <text x="560" y="104" class="dim">9×64</text>
  </g>

  <g id="Vwrap" transform="translate(450,494)">
    <text x="0" y="-16" class="head">VALUES</text>
    <rect width="576" height="81" class="box"/>
    <g id="V"></g>
    <text x="560" y="104" class="dim">9×64</text>
    <text x="288" y="132" class="label" text-anchor="middle" font-style="italic">K = XW<tspan baseline-shift="sub" font-size="75%">K</tspan></text>
    <text x="288" y="158" class="label" text-anchor="middle" font-style="italic">V = XW<tspan baseline-shift="sub" font-size="75%">V</tspan></text>
  </g>

  <!-- K^T strip -->
  <g transform="translate(1050,96)">
    <rect width="63" height="448" class="box"/>
    <g id="KT"></g>
    <text x="18" y="-10" class="label" font-style="italic">K<tspan baseline-shift="super" font-size="70%">T</tspan></text>
  </g>

  <!-- QK^T small product -->
  <g transform="translate(1135,164)">
    <text x="50" y="-10" class="label" text-anchor="middle" font-style="italic">QK<tspan baseline-shift="super" font-size="70%">T</tspan></text>
    <rect width="100" height="100" class="box"/>
    <g id="QKTmini"></g>
  </g>

  <!-- Mask & Softmax -->
  <g transform="translate(1130,292)">
    <rect width="160" height="64" class="chip"/>
    <text x="80" y="26" class="label" text-anchor="middle">Mask &amp;</text>
    <text x="80" y="46" class="label" text-anchor="middle">Softmax</text>
  </g>

  <!-- A = softmax(QK^T / sqrt(d)) headline -->
  <g transform="translate(1310,56)">
    <text x="0" y="0" class="math">A = softmax(</text>
    <text x="228" y="-8" class="label" font-style="italic">QK</text>
    <text x="254" y="-24" class="label" font-style="italic" font-size="16">T</text>
    <text x="272" y="-8" class="label" font-style="italic">/ √d</text>
    <text x="318" y="0" class="math">)</text>
  </g>

  <!-- A 9x9 -->
  <g transform="translate(1305,84)">
    <rect width="342" height="342" class="box"/>
    <g id="A"></g>
    <g id="Ahi"></g>
    <text x="171" y="366" class="label" text-anchor="middle" font-style="italic">ATTENTION PATTERN 9×9</text>

    <!-- y-axis tokens -->
    <g transform="translate(-72,0)">
      <text x="0" y="19"  class="axis">The</text>
      <text x="-25" y="38" class="axis">American</text>
      <text x="-5"  y="57" class="axis">flag</text>
      <text x="8"   y="76" class="axis">is</text>
      <text x="-6"  y="95" class="axis">red</text>
      <text x="15"  y="114" class="axis">,</text>
      <text x="-22" y="133" class="axis">white</text>
      <text x="15"  y="152" class="axis">,</text>
      <text x="-2"  y="171" class="axis">and</text>
    </g>
    <!-- x-axis tokens rotated -->
    <g transform="translate(342,342) rotate(-90)">
      <text x="0" y="19"  class="axis">The</text>
      <text x="-25" y="38" class="axis">American</text>
      <text x="-5"  y="57" class="axis">flag</text>
      <text x="8"   y="76" class="axis">is</text>
      <text x="-6"  y="95" class="axis">red</text>
      <text x="15"  y="114" class="axis">,</text>
      <text x="-22" y="133" class="axis">white</text>
      <text x="15"  y="152" class="axis">,</text>
      <text x="-2"  y="171" class="axis">and</text>
    </g>
  </g>

  <!-- A ⊗ V -> O -->
  <g transform="translate(1192,560)">
    <rect x="0" y="-28" width="110" height="56" class="chip"/>
    <text x="55" y="-6" class="label" text-anchor="middle">A</text>
    <text x="55" y="16" class="label" text-anchor="middle" font-style="italic">⊗</text>
  </g>
  <line x1="1020" y1="585" x2="1192" y2="585" stroke="var(--stroke)" stroke-width="1.8" marker-end="url(#arrow)"/>
  <line x1="1302" y1="585" x2="1486" y2="585" stroke="var(--stroke)" stroke-width="1.8" marker-end="url(#arrow)"/>

  <!-- Head output O -->
  <g transform="translate(1312,520)">
    <text x="0" y="-16" class="head">ATTENTION HEAD OUT</text>
    <rect width="356" height="96" class="box"/>
    <g id="O"></g>
    <text x="328" y="120" class="dim">9×64</text>
    <text x="178" y="144" class="label" text-anchor="middle" font-style="italic">O = AV</text>
  </g>
</svg>

<script>
  // seeded RNG for deterministic noise
  function RNG(seed){let t=seed|0;return()=>{t^=t<<13;t^=t>>>17;t^=t<<5;return ((t>>>0)%1000)/1000}}
  // light ramp blue->violet->gold
  function ramp(v){
    const h = 220 - 160*v;           // 220..60
    const s = 70;
    const l = 88 - 30*v;             // 88..58
    return `hsl(${h} ${s}% ${l}%)`;
  }
  function drawGrid(targetId, rows, cols, cell, seed, {triMask=false, highlight=[]}={}){
    const g = document.getElementById(targetId);
    const rnd = RNG(seed);
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        let v = rnd()*0.65 + 0.15;
        if(triMask && c>r) v = 0.05;             // masked region
        if(r===c) v += .12;                      // mild diagonal
        for(const [rr,cc] of highlight){         // explicit maxima
          if(rr===r && cc===c) v = 1.0;
        }
        if(v>1) v=1;
        const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
        rect.setAttribute("x", c*cell+.3);
        rect.setAttribute("y", r*cell+.3);
        rect.setAttribute("width", cell-.6);
        rect.setAttribute("height", cell-.6);
        rect.setAttribute("fill", ramp(v));
        rect.setAttribute("class","gridcell");
        g.appendChild(rect);
      }
    }
  }
  function outlineCell(targetId, cell, r, c){
    const g = document.getElementById(targetId);
    const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    rect.setAttribute("x", c*cell+.5);
    rect.setAttribute("y", r*cell+.5);
    rect.setAttribute("width", cell-1);
    rect.setAttribute("height", cell-1);
    rect.setAttribute("fill","none");
    rect.setAttribute("stroke","var(--hi)");
    rect.setAttribute("stroke-width","2");
    g.appendChild(rect);
  }

  // draw once DOM is ready
  window.addEventListener('DOMContentLoaded', ()=>{
    // small X blocks (9×12)
    drawGrid('X1',9,12,10,1337);
    drawGrid('X2',9,12,10,2024);

    // Q,K,V 9×64
    drawGrid('Q',9,64,9,3101);
    drawGrid('K',9,64,9,9103);
    drawGrid('V',9,64,9,5207);

    // K^T 64×9 (tall)
    drawGrid('KT',64,9,7,7777);

    // QK^T mini 9×9 with mask preview
    drawGrid('QKTmini',9,9,10,8642,{triMask:true,highlight:[[1,2],[2,1]]});

    // A 9×9 with strong American↔flag after masking
    const A_CELL = 38;
    drawGrid('A',9,9,A_CELL,8642,{triMask:true,highlight:[[1,2],[2,1]]});
    outlineCell('Ahi',A_CELL,1,2);  // American -> flag
    outlineCell('Ahi',A_CELL,2,1);  // flag -> American

    // O 9×64
    drawGrid('O',9,64,10,13579);
  });
</script>
</body>
</html>

